/**
 * 查询专业大类
 */
function fetchBigMajor() {
	$.ajax({
		url : "fetchBigMajor",
		type : 'get',
		success : function(data) {
			$("#div_big_major").html(data);
		}
	});
}
/**
 * 搜索小类
 */
function fetchSmallMajor(majorCode) {
	var param = "majorCode=" + majorCode;
	$.ajax({
		url : "fetchSmallMajor",
		data : param,
		type : 'get',
		success : function(data) {
			$("#div_small_major").html(data);
		}
	});
}
function addBig() {
	$("#div_add_big").is(":visible") ? (function() {
		$("#div_add_big").slideUp();
	}()) : (function() {
		$("#big_name").val("");
		$("#big_sort_no").val("");
		$("#big_code").val("");
		$("#div_add_big").slideDown();

	}());
}
function addSmall() {
	$("#div_add_small").is(":visible") ? (function() {
		$("#div_add_small").slideUp();
	}()) : (function() {
		var startCode = $("#hidBigMajorCode").val().substring(0, 2);
		$("#small_name").val("");
		$("#small_sort_no").val("");
		$("#small_code").val("");
		$("#small_code").val(startCode);
		$("#div_add_small").slideDown();
	}());
}
/**
 * 保存新建专业
 * 
 * @param type
 */
function saveMajor(type) {

	var name = $("#" + type + "_name").val();
	var code = $("#" + type + "_code").val();
	var sortNo = $("#" + type + "_sort_no").val();

	if ($.trim(name) == "") {
		alert("名称不能为空！");
		return;
	}
	if ($.trim(code) == "") {
		alert("编码不能为空！");
		return;
	}
	if ($.trim(code).length != 4) {
		alert("编码必须为4位！")
		return;
	}
	if (type == "big") {
		if (code.substring(code.length - 2, code.length) != "00") {
			alert("编码必须以00结尾！");
			return;
		}
	} else {
		var startCode = $("#hidBigMajorCode").val().substring(0, 2);
		if (code.substring(0, 2) != startCode) {
			alert("编码必须以" + startCode + "开头！");
			return;
		}
		if (code.substring(code.length - 2, code.length) == "00") {
			alert("编码不能以00结尾！");
			return;
		}

	}
	if ($.trim(sortNo) == "") {
		alert("排序号不能为空！");
		return;
	}
	var param = $("#form_add_" + type).serialize();
	$.ajax({
		url : "saveMajor",
		data : param,
		type : 'post',
		success : function(r) {
			if (r == "OK") {
				if (type == "big") {
					fetchBigMajor();
					$("#div_add_big").slideUp();
				} else {
					fetchSmallMajor($("#hidBigMajorCode").val());
					$("#div_add_small").slideUp();
				}
				alert("保存成功!");
			}
		}
	});
}
/**
 * 查看分类详情
 * 
 * @param td
 */
function watchDetail(span, type) {
	var tr = $(span).parents("tr:first");
	var majorCode = tr.find("input.txtMajorCode" + type).val();
	var param = "majorCode=" + majorCode;
	$.ajax({
		url : "fetchSmallMajor",
		data : param,
		type : 'get',
		success : function(data) {
			$("#div_small_major").html(data);
			$("#bigMajorTitle").html($.trim($(span).html()));
			$("#hidBigMajorCode").val(majorCode);
		}
	});
}
/**
 * 编辑专业信息
 * 
 * @param span
 * @param type
 */
function editMajor(span, type) {
	var txt1 = $("<input class='txt1" + type
			+ "' type='text' style='width:150px' maxlength='50'/>");
	var txt2 = $("<input class='txt2" + type
			+ "' type='text' style='width:50px' maxlength='4'/>");
	var txt3 = $("<input class='txt3" + type
			+ "' type='text' style='width:50px' maxlength='4'/>");

	var tr = $(span).parents("tr:first");
	var td1 = tr.find("td.tdName" + type);
	var td2 = tr.find("td.tdCode" + type);
	var td3 = tr.find("td.tdSort" + type);
	var td4 = tr.find("td.tdOperate" + type);

	txt1.val($.trim(td1.find("span").html()));
	txt2.val($.trim(td2.html()));
	txt3.val($.trim(td3.html()));
	td1.html(txt1);
	td2.html(txt2);
	td3.html(txt3);
	txt1.focus();

	td4
			.html("<span style='cursor:pointer;color:blue' onclick='updateCity(this,\""
					+ type + "\")'>保存</span>")
}
/**
 * 删除专业
 * 
 * @param span
 * @param type
 */
function deleteMajor(span, type) {
	var tr = $(span).parents("tr:first");
	var majorId = tr.find("input.txtMajorId" + type).val();
	var param = "majorId=" + majorId;
	$.ajax({
		url : "deleteMajor",
		data : param,
		type : 'get',
		success : function(r) {
			if (r == "OK") {
				fetchBigMajor();
				fetchSmallMajor($("#hidBigMajorCode").val());
				alert("删除成功！");
			}
		}
	});
}
/**
 * 保存编辑的专业
 * 
 * @param span
 * @param type
 */
function updateCity(span, type) {
	var tr = $(span).parents("tr:first");
	var name = tr.find("input.txt1" + type).val();
	var code = tr.find("input.txt2" + type).val();
	var sortNo = tr.find("input.txt3" + type).val();
	var majorId = tr.find("input.txtMajorId" + type).val();
	var hideCode = tr.find("input.txtMajorCode" + type).val();

	if ($.trim(name) == "") {
		alert("名称不能为空！");
		return;
	}
	if ($.trim(code) == "") {
		alert("编码不能为空！");
		return;
	}
	if ($.trim(code).length != 4) {
		alert("编码必须为4位！")
		return;
	}
	var type = "";
	if (hideCode.substring(hideCode.length - 2, hideCode.length) == "00") {
		type = "big";
		if (code.substring(code.length - 2, code.length) != "00") {
			alert("编码必须以00结尾！");
			return;
		}
	} else {
		type = "small";
		var startCode = hideCode.substring(0, 2);
		if (code.substring(0, 2) != startCode) {
			alert("编码必须以" + startCode + "开头！");
			return;
		}
		if (code.substring(code.length - 2, code.length) == "00") {
			alert("编码不能以00结尾！");
			return;
		}
	}
	if ($.trim(sortNo) == "") {
		alert("排序号不能为空！");
		return;
	}

	var param = "majorBo.name=" + name;
	param += "&majorBo.code=" + code;
	param += "&majorBo.sort_no=" + sortNo;
	param += "&majorBo.id=" + majorId;
	$.ajax({
		url : "saveMajor",
		data : param,
		type : 'post',
		success : function(r) {
			if (r == "OK") {
				if (type == "big") {
					fetchBigMajor();
				} else {
					fetchSmallMajor($("#hidBigMajorCode").val());
				}
				alert("修改成功!");
			}
		}
	});
}