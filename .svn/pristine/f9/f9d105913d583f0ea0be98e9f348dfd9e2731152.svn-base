package seentao.xhsn.enterprise.resumesearch.action;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Controller;

import seentao.xhsn.bean.HsDictionaryDataBO;
import seentao.xhsn.bean.HsEnterpriseBO;
import seentao.xhsn.bean.HsInterviewInformBO;
import seentao.xhsn.common.BaseAction;
import seentao.xhsn.common.ResourcesConstants;
import seentao.xhsn.common.SeentaoApplicationContext;
import seentao.xhsn.common.UserSessionBean;
import seentao.xhsn.enterprise.info.service.IEnterpriseService;
import seentao.xhsn.enterprise.manageresume.bean.ManageResumeBean;
import seentao.xhsn.enterprise.resumesearch.bean.ResumeSearchBean;
import seentao.xhsn.enterprise.resumesearch.service.IResumeSearchService;
import seentao.xhsn.sys.dictionaryfiledmap.service.IDictionaryFieldMapService;

/**
 * 搜索简历Dao
 * 
 * @author niushixing 2014-12-15 下午3:19:07
 * 
 */
@Controller
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
public class ResumeSearchAction extends BaseAction {
	private static final long serialVersionUID = 7065544613954031876L;
	private List<ManageResumeBean> resumeList;
	@Autowired
	private IResumeSearchService rsService;
	private ResumeSearchBean rsb;
	private static final int pageSize = 8;
	private List<HsDictionaryDataBO> degreeList;
	private List<HsDictionaryDataBO> jobExpList;
	private List<HsDictionaryDataBO> workStatusList;
	private List<HsDictionaryDataBO> jobProList;
	@Autowired
	private IDictionaryFieldMapService dfmService;
	private HsInterviewInformBO informBO;
	@Autowired
	private IEnterpriseService entService;

	/**
	 * 页面初始化 姓名 应聘职位 性别 年龄 工作年限 现居住地 学历 投递日期
	 * 
	 * @return
	 */
	public String init() {
		Map<String, List<HsDictionaryDataBO>> mapDic1 = new HashMap<String, List<HsDictionaryDataBO>>();
		Map<String, List<HsDictionaryDataBO>> mapDic2 = new HashMap<String, List<HsDictionaryDataBO>>();
		Map<String, List<HsDictionaryDataBO>> mapDic3 = new HashMap<String, List<HsDictionaryDataBO>>();
		mapDic1 = dfmService.findDictDataByParam("hs_subjoin");
		mapDic2 = dfmService.findDictDataByParam("hs_userbasicinfo");
		mapDic3 = dfmService.findDictDataByParam("hs_desired_position");
		if (null != mapDic1 && mapDic1.size() > 0) {
			degreeList = mapDic1.get("education_type");
			jobExpList = mapDic2.get("user_jobexp");
			workStatusList = mapDic3.get("current_job_state");
		}

		// 初始化面试通知部分数据
		informBO = new HsInterviewInformBO();
		String etp_id = ((UserSessionBean) SeentaoApplicationContext.getSession(ResourcesConstants.LOGIN_SESSION_KEY))
				.getUser_id();
		HsEnterpriseBO entBo = entService.getByPK(etp_id);
		informBO.setEnt_id(entBo.getId());
		informBO.setEnt_name(entBo.getEnt_name());
		informBO.setEnt_address(entBo.getCom_address());
		informBO.setInterviewer(entBo.getCom_people());
		informBO.setInterviewer_phone(entBo.getCom_telephone());
		return SUCCESS;
	}

	/**
	 * 搜索数据
	 * 
	 * @return
	 */
	public String search() {
		page.setPageSize(pageSize);
		Map<String, Object> params = new HashMap<String, Object>();
		if (null == rsb)
			rsb = new ResumeSearchBean();
		String com_id = ((UserSessionBean) SeentaoApplicationContext.getSession(ResourcesConstants.LOGIN_SESSION_KEY))
				.getUser_id();
		rsb.setCom_id(com_id);
		if (rsb.getTrade_code() != null && !rsb.getTrade_code().equals("")) {
			if (rsb.getTrade_code().indexOf("99") >= 0) {
				rsb.setTrade_code("");
			}
		}
		params.put("bo", rsb);
		page.setParams(params);
		resumeList = rsService.getResumeSearchResult(page);
		return SUCCESS;
	}

	private String res_id;

	/**
	 * 关注简历
	 * 
	 * @return
	 */
	public String followResume() {
		resultStr = rsService.followResume(res_id);
		return SUCCESS;
	}

	public List<ManageResumeBean> getResumeList() {
		return resumeList;
	}

	public void setResumeList(List<ManageResumeBean> resumeList) {
		this.resumeList = resumeList;
	}

	public ResumeSearchBean getRsb() {
		return rsb;
	}

	public void setRsb(ResumeSearchBean rsb) {
		this.rsb = rsb;
	}

	public List<HsDictionaryDataBO> getDegreeList() {
		return degreeList;
	}

	public void setDegreeList(List<HsDictionaryDataBO> degreeList) {
		this.degreeList = degreeList;
	}

	public List<HsDictionaryDataBO> getJobExpList() {
		return jobExpList;
	}

	public void setJobExpList(List<HsDictionaryDataBO> jobExpList) {
		this.jobExpList = jobExpList;
	}

	public List<HsDictionaryDataBO> getWorkStatusList() {
		return workStatusList;
	}

	public void setWorkStatusList(List<HsDictionaryDataBO> workStatusList) {
		this.workStatusList = workStatusList;
	}

	public List<HsDictionaryDataBO> getJobProList() {
		return jobProList;
	}

	public void setJobProList(List<HsDictionaryDataBO> jobProList) {
		this.jobProList = jobProList;
	}

	public String getRes_id() {
		return res_id;
	}

	public void setRes_id(String res_id) {
		this.res_id = res_id;
	}

	public HsInterviewInformBO getInformBO() {
		return informBO;
	}

	public void setInformBO(HsInterviewInformBO informBO) {
		this.informBO = informBO;
	}
}
