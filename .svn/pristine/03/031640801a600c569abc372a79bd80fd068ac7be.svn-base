package seentao.xhsn.person.certificate.action;

import java.io.File;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.log4j.Logger;
import org.apache.struts2.ServletActionContext;
import org.apache.struts2.json.annotations.JSON;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Controller;

import seentao.xhsn.person.certificate.bean.HsCertificateExtendBO;
import seentao.xhsn.person.certificate.service.ICertificateUploadService;
import seentao.xhsn.sys.learnpathupload.action.LearnPathUploadAction;

import com.opensymphony.xwork2.ActionSupport;

/**
 * @Description:证件上传
 * @author 李君彦
 * @date 2014-12-12 上午10:57:31 
 * @version V1.0   
 */
@Controller
@Scope("prototype")
public class CertificateUploadAction extends ActionSupport{
	private static final long serialVersionUID = 1L;
	private Logger logger = Logger.getLogger(LearnPathUploadAction.class);
		
		private String fileDataID;
		// 上传文件集合
		private List<File> file;
		// 上传文件名集合
		private List<String> fileFileName;
		// 上传文件内容类型集合
		private List<String> fileContentType;
		
		private HsCertificateExtendBO bo;
		@Autowired
		private ICertificateUploadService certificateUploadService;
		
		public String execute() throws Exception {
			
			HttpServletResponse response = ServletActionContext.getResponse(); 
			HttpServletRequest request = ServletActionContext.getRequest();
			String ip=request.getRemoteAddr();
		      response.setCharacterEncoding("utf-8");  
			
			if (file != null && file.size() > 0&&file.get(0)!=null){
				long size = file.get(0).length();
				if (size > 2097152) {
					response.getWriter().print("{\"error\":\"error\"}");  
				}else{
					String  json=certificateUploadService.saveAndUpload(file.get(0),bo,fileFileName.get(0),ip);
					response.getWriter().print(json);  
				}	
			}
			return null; 
		}
	
		/**
		 * 删除附件操作
		 * @return
		 */
		public String delCertificateFile(){
			certificateUploadService.delCertificateFile(fileDataID);
			return null;
		}
		
		@JSON(serialize = false)
		public List<File> getFile() {
			return file;
		}

		public void setFile(List<File> file) {
			this.file = file;
		}
		
		public List<String> getFileFileName() {
			return fileFileName;
		}

		public void setFileFileName(List<String> fileFileName) {
			this.fileFileName = fileFileName;
		}
		@JSON(serialize = false)
		public List<String> getFileContentType() {
			return fileContentType;
		}

		public void setFileContentType(List<String> fileContentType) {
			this.fileContentType = fileContentType;
		}

		public HsCertificateExtendBO getBo() {
			return bo;
		}

		public void setBo(HsCertificateExtendBO bo) {
			this.bo = bo;
		}

		public String getFileDataID() {
			return fileDataID;
		}

		public void setFileDataID(String fileDataID) {
			this.fileDataID = fileDataID;
		}

		
}
