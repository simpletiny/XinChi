$(document).ready(function() {
	$('.search_inner ul li p .company').addClass('active')
	$('.search_inner ul li p a').click(function() {
		$('.search_inner ul li p a').removeClass('active')
		$(this).addClass('active')
	})
	//参数1 action地址  
	//参数2 参数信息 不包括分页参数 
	//参数3 从第几页开始
	//参数4 每页记录数
	
	/*var formparam = $("#myform").serialize();
	fenye('person/jobsearch','',1,3);*/
});

// 是否在数组内
function in_array(needle, haystack) {
	if (typeof needle == 'string' || typeof needle == 'number') {
		for ( var i in haystack) {
			if (haystack[i] == needle) {
				return true;
			}
		}
	}
	return false;
}
function clicka(str){
	if(str == 'company'){
		$("#company_div").css("display","block");
		$("#job_div").css("display","none");
		$("#rel_name").val('');
	}else if(str == 'job'){
		$("#company_div").css("display","none");
		$("#job_div").css("display","block");
		$("#company_name").val('');
	}
}
function validateform(){
	//TODO: 验证表单
	
	return true;
}

function formsub(){
	var validate_flag = false;
	validate_flag = validateform();
	if(validate_flag){
		/*document.getElementById("myform").action = "person/jobsearch";
		document.getElementById("myform").submit();*/
		var formparam = $("#myform").serialize();
		fenye('person/jobsearch',formparam,1,5);
	}
}

function handleResponse(data,action,param){
	$("#content").empty();
	$("#res_id").val(data.res_id);
	$.each(data.result_jobs, function(i, item) {
		var address=getTextByCodes(item.jobAddress, ja);
		var tr = "<li>" +
		 		"	<ul>";
        tr = tr +
            "<li class='job_n'><a style='color:#05a687;' href='person/jobDetailInit?releaseJobId=" + item.id + "'><input name='job' type='checkbox' value='" + item.id + "' />" + item.jobName + "</a></li>" +
        	"<li class='company_n'><a style='color:#05a687;' href='person/jobDetailInit?releaseJobId=" + item.id + "'>" + item.companyName + "</a></li>" +
        	"<li class='money'>" + item.monthlyPay + "</li>" +
        	"<li class='place'>" + address +"</li>" +
        	"<li class='date'>" + item.publishDate + "</li>" +
            "<br />";
       	 $("#content").append(tr+"</ur> </li>");
      });
	 appendPage(data.page,action,param);  
}

function jobSelectAll(elem){
	if($("#btn_job").attr("checked")){
		$("[name='job']").attr("checked",'true');//全选
	}else{
		$("[name='job']").removeAttr("checked");//取消全选
	}
}

//申请职位
function putresume(){
	//1、获取已选中的
	var action = "person/putresumes";
	//1、获取已选中的
	var job_ids = "";
	$("input[name='job']:checked").each(function () {
		job_ids += "," + this.value;
	})
	if(job_ids.length > 0){
		job_ids = job_ids.substring(1);
		var res_id = $("#res_id").val();
		var dataParam = "job_ids=" + job_ids + "&res_id=" + res_id;
		$.ajax({
	        url: action,
	        data: dataParam,
	        type: "post",
	        dataType: "json",
	        success: function(data){
	        	//handleResponse(data,action,param);
	        	if(data.put_count){
	        		alert("职位申请成功！ 已经申请了" + data.put_count + " 个职位！");
	        	}
	        },
	        error:function(data){
	        	alert("操作失败，请稍后重试！");
	        }
		}); 
	}else{
		alert("请选择一条记录！");
	}
}

function goback(){
	window.history.back();
}

function plsczw(){
	
	var action = "person/positionCollectByIDs";
	//1、获取已选中的
	var job_ids = "";
	$("input[name='job']:checked").each(function () {
		job_ids += "," + this.value;
	})
	if(job_ids.length > 0){
		job_ids = job_ids.substring(1);
		var dataParam = "job_ids=" + job_ids;
		$.ajax({
	        url: action,
	        data: dataParam,
	        type: "post",
	        dataType: "json",
	        success: function(data){
	        	//handleResponse(data,action,param);
	        	if(data.collent_count){
	        		alert("收藏职位成功！ 已经收藏了" + data.collent_count + " 个职位！");
	        	}
	        },
	        error:function(data){
	        	alert("操作失败，请稍后重试！");
	        }
		}); 
	}else{
		alert("请选择一条记录！");
	}
	
}

//将编码转换成字符串
function getTextByCodes(codes, arraytext) {
	var arr = codes.split(",");
	var texts = "";
	for (var i = 0; i < arr.length; i++) {
		var code = arr[i];
		texts += "," + arraytext[code];
	}
	texts = texts.substring(1);
	return texts;
}