$(document).ready(function() {
	$('#main .zt .sx').addClass('active')
	$('#main .zt input').click(function() {
		$('#main .zt input').removeClass('active')
		$(this).addClass('active');
		showPage();
	});
	$('#main .yq .sx').addClass('active')
	$('#main .yq input').click(function() {
		$('#main .yq input').removeClass('active')
		$(this).addClass('active');
		showPage();
	});

	$('#main ul li .sd_b').addClass('active')
	$('#main ul li .sd_b').click(function() {
		$('#main ul li .gz_b').removeClass('active')
		$(this).addClass('active')
		showPage("sd");
	});

	$('#main ul li .gz_b').click(function() {
		$('#main ul li .sd_b').removeClass('active')
		$(this).addClass('active')
		showPage("gz");
	});

	$("#tanchu").hide();
	$(".transparent").hide();
	$(".close").click(function() {
		$("#tanchu").hide();
		$(".transparent").hide();
	});
	switchTab(4);
	showPage("sd");
});
var st_type = "sd";
/**
 * 显示面试通知页面
 */
function showInterview() {
	var ids = new Array();
	$.each($("input[name='chkEach']"), function(n, value) {
		if ($(value).attr("checked")) {
			var eachId = $(value).prev("input").val();
			ids.push(eachId);
		}
	});
	if (ids.length < 1) {
		alert("请选择简历。");
		return;
	}
	var bodyWidth = $("body").width();
	var transheight = $(document.body).outerHeight(true);
	var loginWidth = $("#tanchu").width();
	var num = (bodyWidth - (loginWidth)) / 2;

	$(".transparent").show();
	$(".transparent").css("width", bodyWidth);
	$(".transparent").css("height", transheight);
	$("#tanchu").css("left", num);
	$("#tanchu").css("top", "110px");
	$("#tanchu").show();
}
/**
 * 取得检索条件
 * 
 * @returns {String}
 */
function collectParam() {
	var param = "&param=";
	$("#main input.active");
	$.each($("#main input.active"), function(n, value) {
		var code = $(value).prev("input:first").val();
		code = encodeURI(code);
		param += code + ",";
	});
	param = param.substring(0, param.length - 1);
	return param;
}
function showPage(type) {
	$("#chk_all").attr("checked", false);
	st_type = !type ? st_type : type;
	var param = "type=" + st_type;
	param += collectParam();
	var layIndex = layer.load('请稍候...', 0);
	$.ajax({
		url : "findJobListForEnt",
		data : param,
		type : "post",
		success : function(data) {
			layer.close(layIndex);
			$("#data_container").html(data);
			$("#Pagination").pagination($("#hid_sum_cnt").val() - 0, {
				callback : searchData,// PageCallback() 为翻页调用次函数。
				items_per_page : 7, // 每页的数据个数
				num_display_entries : 3, // 两侧首尾分页条目数
				current_page : 0, // 当前页码
				num_edge_entries : 2
			});
		}
	});
}
var st_page_id = 0;
/**
 * 搜索数据
 */
function searchData(page_id, jq) {
	var param = "page.pageNo=" + (page_id + 1);
	param += "&type=" + st_type;
	param += collectParam();
	var layIndex = layer.load('请稍候...', 0);
	$.ajax({
		url : "findJobListForEnt",
		data : param,
		type : "post",
		success : function(data) {
			layer.close(layIndex);
			$("#data_container").html(data);
			st_page_id = page_id;
		}
	});
}
/**
 * 全选
 */
function checkAll() {
	$.each($("input[name='chkEach']"), function(n, value) {
		$(value).attr("checked", !!$("#chk_all").attr("checked"));
	});
}
/**
 * 验证面试通知填写内容
 * 
 * @returns {Boolean}
 */
function validate_sendinform() {
	var names = [ "面试地址", "面试岗位", "联系人", "联系电话", "需带资料", "面试时间" ];
	var needInput = $(".tanchu_inner input[type='text']");
	for (var i = 0; i < needInput.length; i++) {
		var txt = needInput[i];
		if ($.trim($(txt).val()) == "") {
			alert(names[i] + "不能为空");
			return false;
		}
	}
	return true;
}
/**
 * 发送面试通知
 */
function sendinform() {
	if (!validate_sendinform())
		return;
	var ids = new Array();
	$.each($("input[name='chkEach']"), function(n, value) {
		if ($(value).attr("checked")) {
			var eachId = $(value).prev("input").val();
			ids.push(eachId);
		}
	});
	var param = $("#myform").serialize();
	param += "&ids=" + ids;
	param += "&type=" + st_type;
	var layIndex = layer.load('请稍候...', 0);
	$.ajax({
		url : 'sendInforms',
		data : param,
		type : "post",
		success : function(data) {
			layer.close(layIndex);
			if (data == "OK") {
				alert("发送成功");
				$("#tanchu").hide();
				$(".transparent").hide();
			}
		},
		error : function(data) {
			alert("操作失败，请稍后重试！");
		}
	});
}
/**
 * 收藏简历
 */
function storeResume() {
	var ids = new Array();
	$.each($("input[name='chkEach']"), function(n, value) {
		if ($(value).attr("checked")) {
			var eachId = $(value).prev("input").val();
			ids.push(eachId);
		}
	});
	if (ids.length < 1) {
		alert("请选择需要收藏的简历。")
		return;
	}
	var param = "ids=" + ids;
	param += "&type=" + st_type;
	$.ajax({
		url : 'storeResumes',
		data : param,
		type : "post",
		success : function(data) {
			if (data == "OK") {
				alert("收藏成功");
			}
		},
		error : function(data) {
			alert("操作失败，请稍后重试！");
		}
	});
}
/**
 * 关注简历
 */
function followResume() {
	var ids = new Array();
	$.each($("input[name='chkEach']"), function(n, value) {
		if ($(value).attr("checked")) {
			var eachId = $(value).prev("input").val();
			ids.push(eachId);
		}
	});
	if (ids.length < 1) {
		alert("请选择需要关注的简历。");
		return;
	}
	var param = "ids=" + ids;
	param += "&type=" + st_type;
	var layIndex = layer.load('请稍候...', 0);
	$.ajax({
		url : 'followResumes',
		data : param,
		type : "post",
		success : function(data) {
			layer.close(layIndex);
			if (data == "OK") {
				alert("关注成功");

			}
		},
		error : function(data) {
			alert("操作失败，请稍后重试！");
		}
	});
}
/**
 * 取消关注简历
 */
function cancelCare() {
	var ids = new Array();
	$.each($("input[name='chkEach']"), function(n, value) {
		if ($(value).attr("checked")) {
			var eachId = $(value).prev("input").val();
			ids.push(eachId);
		}
	});
	if (ids.length < 1) {
		alert("请选择需要取消关注的简历。");
		return;
	}
	var param = "ids=" + ids;
	var layIndex = layer.load('请稍候...', 0);
	$.ajax({
		url : 'cancelFollowResume',
		data : param,
		type : "post",
		success : function(data) {
			layer.close(layIndex);
			if (data == "OK") {
				alert("取消成功");
				searchData(st_page_id);
			}
		},
		error : function(data) {
			alert("操作失败，请稍后重试！");
		}
	});
}