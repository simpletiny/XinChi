package seentao.xhsn.enterprise.releasejob.action;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Controller;

import seentao.xhsn.bean.HsEnterpriseBO;
import seentao.xhsn.bean.HsEtpReleasejobBO;
import seentao.xhsn.bean.HsInterviewInformBO;
import seentao.xhsn.common.BaseAction;
import seentao.xhsn.common.ResourcesConstants;
import seentao.xhsn.common.SeentaoApplicationContext;
import seentao.xhsn.common.UserSessionBean;
import seentao.xhsn.enterprise.info.service.IEnterpriseService;
import seentao.xhsn.enterprise.manageresume.bean.ManageResumeBean;
import seentao.xhsn.enterprise.manageresume.service.IManageResumeService;
import seentao.xhsn.enterprise.releasejob.bean.EnterpriseJobInfo;
import seentao.xhsn.enterprise.releasejob.service.IReleasejobService;

/**
 * 职位管理Action
 * 
 * @author niushixing 2014-12-3 下午4:30:06
 * 
 */
@Controller
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
public class ManageJobAction extends BaseAction {
	private static final long serialVersionUID = -6682660587631386216L;
	private String id;
	private HsEtpReleasejobBO rjbo;
	private EnterpriseJobInfo job;
	private List<EnterpriseJobInfo> jobList;
	private final static int pageSize = 6;
	@Autowired
	private IReleasejobService rjService;
	// 职位类型 已发布1，未发布0，已结束2,已删除3
	private String type;

	private String result;

	/**
	 * 页面初始化
	 * 
	 * @return
	 */
	public String init() {
		type = IReleasejobService.STATUS_PUBLISHED;
		page.setPageSize(pageSize);
		jobList = rjService.findJobList(type, page);
		return SUCCESS;
	}

	private String target;

	/**
	 * 取得指定的职位信息
	 * 
	 * @return
	 */
	public String findJobList() {
		page.setPageSize(pageSize);
		jobList = rjService.findJobList(type, page);
		target = "joblist" + type;
		return SUCCESS;
	}

	/**
	 * 刷新当前简历
	 * 
	 * @return
	 */
	public String refresh() {
		job = rjService.getJobInfoById(id);
		return SUCCESS;
	}

	/**
	 * 结束当前简历
	 * 
	 * @return
	 */
	public String end() {
		rjService.updateJobStatus(id, IReleasejobService.STATUS_ENDED);
		result = "OK";
		return SUCCESS;
	}

	/**
	 * 删除当前简历
	 * 
	 * @return
	 */
	public String delete() {
		rjService.updateJobStatus(id, IReleasejobService.STATUS_DELETED);
		result = "OK";
		return SUCCESS;
	}

	/**
	 * 发布职位
	 * 
	 * @return
	 */
	public String publish() {
		rjService.updateJobStatus(id, IReleasejobService.STATUS_PUBLISHED);
		result = "OK";
		return SUCCESS;
	}

	private List<ManageResumeBean> resumeList;
	@Autowired
	private IManageResumeService mrService;
	private String job_id;
	private HsInterviewInformBO informBO;

	@Autowired
	private IEnterpriseService entService;

	public String getReceivedResume() {
		id = ((UserSessionBean) SeentaoApplicationContext.getSession(ResourcesConstants.LOGIN_SESSION_KEY))
				.getUser_id();
		page.setPageSize(pageSize);
		ManageResumeBean bo = new ManageResumeBean();
		bo.setCom_id(id);
		bo.setJob_id(job_id);
		Map<String, Object> map = new HashMap<String, Object>();
		map.put("bo", bo);
		page.setParams(map);
		resumeList = mrService.fetchResume(page, "sd");

		// 初始化面试通知部分数据
		informBO = new HsInterviewInformBO();
		String etp_id = ((UserSessionBean) SeentaoApplicationContext.getSession(ResourcesConstants.LOGIN_SESSION_KEY))
				.getUser_id();
		HsEnterpriseBO entBo = entService.getByPK(etp_id);
		informBO.setEnt_id(entBo.getId());
		informBO.setEnt_name(entBo.getEnt_name());
		informBO.setEnt_address(entBo.getCom_address());
		informBO.setInterviewer(entBo.getCom_people());
		informBO.setInterviewer_phone(entBo.getCom_telephone());

		return SUCCESS;
	}

	public String getReceivedResumeSub() {
		id = ((UserSessionBean) SeentaoApplicationContext.getSession(ResourcesConstants.LOGIN_SESSION_KEY))
				.getUser_id();
		page.setPageSize(pageSize);
		ManageResumeBean bo = new ManageResumeBean();
		bo.setCom_id(id);
		bo.setJob_id(job_id);
		Map<String, Object> map = new HashMap<String, Object>();
		map.put("bo", bo);
		page.setParams(map);
		resumeList = mrService.fetchResume(page, "sd");
		return SUCCESS;
	}

	public String getId() {
		return id;
	}

	public void setId(String id) {
		this.id = id;
	}

	public String getType() {
		return type;
	}

	public void setType(String type) {
		this.type = type;
	}

	public List<EnterpriseJobInfo> getJobList() {
		return jobList;
	}

	public void setJobList(List<EnterpriseJobInfo> jobList) {
		this.jobList = jobList;
	}

	public String getTarget() {
		return target;
	}

	public void setTarget(String target) {
		this.target = target;
	}

	public String getResult() {
		return result;
	}

	public void setResult(String result) {
		this.result = result;
	}

	public HsEtpReleasejobBO getRjbo() {
		return rjbo;
	}

	public void setRjbo(HsEtpReleasejobBO rjbo) {
		this.rjbo = rjbo;
	}

	public EnterpriseJobInfo getJob() {
		return job;
	}

	public void setJob(EnterpriseJobInfo job) {
		this.job = job;
	}

	public List<ManageResumeBean> getResumeList() {
		return resumeList;
	}

	public void setResumeList(List<ManageResumeBean> resumeList) {
		this.resumeList = resumeList;
	}

	public String getJob_id() {
		return job_id;
	}

	public void setJob_id(String job_id) {
		this.job_id = job_id;
	}

	public HsInterviewInformBO getInformBO() {
		return informBO;
	}

	public void setInformBO(HsInterviewInformBO informBO) {
		this.informBO = informBO;
	}
}
