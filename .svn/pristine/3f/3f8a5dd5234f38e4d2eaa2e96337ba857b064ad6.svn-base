package seentao.xhsn.sys.leftmenu.dao.impl;

import java.util.List;

import org.apache.ibatis.session.SqlSession;
import org.mybatis.spring.support.SqlSessionDaoSupport;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import seentao.xhsn.bean.HsPersonLeftMenuBO;
import seentao.xhsn.bean.HsPersonLeftmenuDataBO;
import seentao.xhsn.bean.HsResumeBO;
import seentao.xhsn.common.DaoUtil;
import seentao.xhsn.common.DictionaryEnum;
import seentao.xhsn.common.ResourcesConstants;
import seentao.xhsn.sys.leftmenu.dao.ILeftMenuDao;
import seentao.xhsn.sys.leftmenudate.dao.ILeftMenuDataDAO;

/** 
 * @author wjx 
 * @date 2014年12月1日 下午3:38:14 
 * @note 
 */
@Service
public class LeftMenuDaoImpl extends SqlSessionDaoSupport implements
		ILeftMenuDao {

	@Autowired 
	private  ILeftMenuDataDAO leftMenuDataDAO;
	
	private SqlSession sqlSession;
	private DaoUtil daoUtil;

	public void initDao() {
		if (daoUtil == null) {
			sqlSession = sqlSession == null ? getSqlSession() : sqlSession;
			daoUtil = new DaoUtil(sqlSession);
		}
	}
	
	@Override
	public List<HsPersonLeftMenuBO> findLeftMenuAndDataByParam(HsPersonLeftMenuBO param) {
		return daoUtil.selectByBOParamT("seentao.xhsn.bean.mappers.HsPersonLeftMenuBOMapper.selectListByParam", param);
	}
	
	/* （非 Javadoc） 根据用户id和简历id初始化个人菜单信息
	 * @see seentao.xhsn.sys.leftmenu.dao.ILeftMenuDao#insterInstence(java.lang.String, java.lang.String)
	 */
	public void insterInstence(String user_id, String res_id){
		List<HsPersonLeftMenuBO> menus = findAllLeftMenu();
		for (int i = 0; i < menus.size(); i++) {
			HsPersonLeftMenuBO menu = menus.get(i);
			HsPersonLeftmenuDataBO bo = new HsPersonLeftmenuDataBO();
			bo.setMenu_id(menu.getId());
			bo.setUser_id(user_id);
			bo.setRes_id(res_id);
			bo.setScore(0);
			if(ResourcesConstants.LEFT_MENU_LEARNPATH.equals(menu.getTab_name())){
				bo.setClass_name(DictionaryEnum.MENU_TOTALLY.getStringValue());
			}else if(ResourcesConstants.LEFT_MENU_MYSELF.equals(menu.getTab_name())){
				bo.setClass_name(DictionaryEnum.MENU_HALF.getStringValue());
			}else{
				bo.setClass_name(DictionaryEnum.MENU_NEVER.getStringValue());
			}
			leftMenuDataDAO.insert(bo);
		}
	}

	@Override
	public String insert(HsPersonLeftMenuBO bo){
		return daoUtil.insertBO("seentao.xhsn.bean.mappers.HsPersonLeftMenuBOMapper.insert", bo);
	}

	@Override
	public int updateByParam(HsPersonLeftMenuBO bo) {
		return daoUtil.updateByBOParam("seentao.xhsn.bean.mappers.HsPersonLeftMenuBOMapper.updateByParamForClassName", bo);
	}

	@Override
	public int updateResByParam(HsResumeBO bo) {
		return daoUtil.updateByPK("seentao.xhsn.bean.mappers.HsResumeBOMapper.updateByPrimaryKey", bo);
	}

	@Override
	public HsResumeBO getCompletenessByPk(String id) {
		return (HsResumeBO) daoUtil.selectByPK("seentao.xhsn.bean.mappers.HsResumeBOMapper.selectByPrimaryKey", id);
	}

	@Override
	public List<HsPersonLeftMenuBO> findAllLeftMenu() {
		return daoUtil.selectByBOParamT("seentao.xhsn.bean.mappers.HsPersonLeftMenuBOMapper.selectAllMenu", new HsPersonLeftMenuBO());
	}

	@Override
	public HsPersonLeftMenuBO getMenuByTabName(String tab_name) {
		HsPersonLeftMenuBO param = new HsPersonLeftMenuBO();
		param.setTab_name(tab_name);
		return daoUtil.selectOneValueByParam("seentao.xhsn.bean.mappers.HsPersonLeftMenuBOMapper.selectByParam", param);
	}

	@Override
	public void updateMenuDataByParam(HsPersonLeftMenuBO param) {
		leftMenuDataDAO.updateScoreByParam(param);
	}

	@Override
	public void deleteByParam(String user_id, String res_id) {
		HsPersonLeftmenuDataBO param = new HsPersonLeftmenuDataBO();
		param.setUser_id(user_id);
		param.setRes_id(res_id);
		leftMenuDataDAO.deleteByParam(param);
		
	}

	
}
