$(document).ready(
		function() {
			// $(" body").click(function() {
			// $("#degree_selectbox").hide();
			// $("#working_selectbox").hide();
			// });

			var hukou = $("#hukou").val();
			if (hukou != "") {
				$("#btn_hukou").val(ja[hukou]);
			}
			// 如果有搜索条件，那么就搜索
			if (hukou != "" || $("#hid_job_exp").val() != ""
					|| $("#txt_job_name").val() != "") {
				showPage();
			}
			// 点击搜索按钮
			$("#btn_search").click(function() {
				showPage();
			});

			$(".transparent").hide();
			$(".close").click(function() {
				$("#tanchu").hide();
				$(".transparent").hide();
			});
			switchTab(5);
		});

function hide(id) {
	$(id).is(":visible") ? $(id).hide() : $(id).show();
}
/**
 * 通过名称获取工作Code
 * 
 * @param jobName
 */
function getJobTypeByName(jobName) {
	var jobCodes = new Array();
	if (jobName == "")
		return jobCodes;
	for ( var i in fun_a) {
		if (fun_a[i].indexOf(jobName) >= 0) {
			jobCodes.push(i);
		}
	}
	if (jobCodes.length == 0) {
		jobCodes.push("NOTEXISTS");
	}
	return jobCodes;
}
/**
 * 搜索数据
 */
function showPage() {
	var jobCodes = getJobTypeByName($.trim($("#txt_job_name").val()));
	var param = $("#search_form").serialize();
	param += "&" + "rsb.job_type=" + jobCodes;
	var layIndex = layer.load('请稍候...', 0);
	$.ajax({
		url : 'searchResumeForEnt',
		data : param,
		type : 'post',
		success : function(data) {
			layer.close(layIndex);
			$('#resume_container').html(data);
			$("#Pagination").pagination($("#hid_sum_cnt").val() - 0, {
				callback : searchData,// PageCallback() 为翻页调用次函数。
				items_per_page : 8, // 每页的数据个数
				num_display_entries : 3, // 两侧首尾分页条目数
				current_page : 0, // 当前页码
				num_edge_entries : 2
			});
			if ($("#hid_sum_cnt").val() - 0 == 0) {
				$('#resume_container').html(
						"<p style='color:red'>没有满足条件的结果</p>");
			}
		},
		error : function(data) {
			alert("操作失败，请稍后重试！");
		}
	});
}
var st_page_id = 0;
/**
 * 搜索数据
 */
function searchData(page_id, jq) {
	st_page_id = page_id;
	var jobCodes = getJobTypeByName($.trim($("#txt_job_name").val()));
	var param = $("#search_form").serialize();
	param += "&page.pageNo=" + (page_id + 1);
	param += "&" + "rsb.job_type=" + jobCodes;
	var layIndex = layer.load('请稍候...', 0);
	$.ajax({
		url : 'searchResumeForEnt',
		data : param,
		type : 'post',
		success : function(data) {
			layer.close(layIndex);
			$('#resume_container').html(data);
		},
		error : function(data) {
			alert("操作失败，请稍后重试！");
		}
	});
}
/**
 * 选择值
 * 
 * @param code
 * @param input
 */
function pickValue(code, input, span) {
	$(input).prev('input').val(code);
	$(input).val($(span).html() == "&nbsp;" ? "" : $(span).html());
	$(span).parent().hide();
}
// 是否在数组内
function in_array(needle, haystack) {
	if (typeof needle == 'string' || typeof needle == 'number') {
		for ( var i in haystack) {
			if (haystack[i] == needle) {
				return true;
			}
		}
	}
	return false;
}
/**
 * 关注简历
 */
function followResume(alink) {
	var tr = $(alink).parents("tr:first");
	var resumeId = $(tr).find("input.txtResumeId:first").val();

	var param = "res_id=" + resumeId;
	$.ajax({
		url : 'followResumeInSearch',
		data : param,
		type : "post",
		success : function(data) {
			if (data == "OK") {
				alert("关注成功");
				$(alink).parent().html("已关注");
			}
		},
		error : function(data) {
			alert("操作失败，请稍后重试！");
		}
	});
}

/**
 * 企业端预览简历
 * 
 * @param td
 */
function viewResume(td) {
	var res_id = $($(td).parent()).find("input.txtResumeId:first").val();
	var id_card = $($(td).parent()).find("input.txtIdCard:first").val();
	window
			.open(
					'viewResume?res_id=' + res_id + "&id_card=" + id_card,
					'newwindow',
					'width=800,height=700,top=100,left=200,toolbar=no,menubar=no,scrollbars=yes,resizable=no,location=no,status=no');
}
/**
 * 全选
 */
function checkAll() {
	$.each($("input[name='chkEach']"), function(n, value) {
		$(value).attr("checked", !!$("#chk_all").attr("checked"));
	});
}

/**
 * 显示面试通知页面
 */
function showInterview() {
	var ids = new Array();
	$.each($("input[name='chkEach']"), function(n, value) {
		if ($(value).attr("checked")) {
			var eachId = $(value).parents("tr:first").find(
					"input.txtResumeId:first").val();
			ids.push(eachId);
		}
	});
	if (ids.length < 1) {
		alert("请选择简历。");
		return;
	}

	var bodyWidth = $("body").width();
	var transheight = $(document.body).outerHeight(true);
	var loginWidth = $("#tanchu").width();
	var num = (bodyWidth - (loginWidth)) / 2;

	$(".transparent").show();
	$(".transparent").css("width", bodyWidth);
	$(".transparent").css("height", transheight);
	$("#tanchu").css("left", num);
	$("#tanchu").css("top", "110px");
	$("#tanchu").show();
}
/**
 * 验证面试通知填写内容
 * 
 * @returns {Boolean}
 */
function validate_sendinform() {
	var names = [ "面试地址", "面试岗位", "联系人", "联系电话", "需带资料", "面试时间" ];
	var needInput = $(".tanchu_inner input[type='text']");
	for (var i = 0; i < needInput.length; i++) {
		var txt = needInput[i];
		if ($.trim($(txt).val()) == "") {
			alert(names[i] + "不能为空");
			return false;
		}
	}
	return true;
}
/**
 * 发送面试通知
 */
function sendinform() {
	if (!validate_sendinform())
		return;
	var ids = new Array();
	$.each($("input[name='chkEach']"), function(n, value) {
		if ($(value).attr("checked")) {
			var eachId = $(value).parents("tr:first").find(
					"input.txtResumeId:first").val();
			ids.push(eachId);
		}
	});
	var param = $("#myform").serialize();
	param += "&ids=" + ids;
	var layIndex = layer.load('请稍候...', 0);
	$.ajax({
		url : 'sendInforms',
		data : param,
		type : "post",
		success : function(data) {
			layer.close(layIndex);
			if (data == "OK") {
				alert("发送成功");
				$("#tanchu").hide();
				$(".transparent").hide();
			}
		},
		error : function(data) {
			alert("操作失败，请稍后重试！");
		}
	});
}

/**
 * 关注简历
 */
function followResumes() {
	var ids = new Array();
	$.each($("input[name='chkEach']"), function(n, value) {
		if ($(value).attr("checked")) {
			var eachId = $(value).parents("tr:first").find(
					"input.txtResumeId:first").val();
			ids.push(eachId);
		}
	});
	if (ids.length < 1) {
		alert("请选择简历。");
		return;
	}
	var param = "ids=" + ids;
	var layIndex = layer.load('请稍候...', 0);
	$.ajax({
		url : 'followResumes',
		data : param,
		type : "post",
		success : function(data) {
			layer.close(layIndex);
			if (data == "OK") {
				alert("关注成功");
				searchData(st_page_id, null);
			}
		},
		error : function(data) {
			alert("操作失败，请稍后重试！");
		}
	});
}